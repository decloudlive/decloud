(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     15912,        356]
NotebookOptionsPosition[     15499,        337]
NotebookOutlinePosition[     15860,        353]
CellTagsIndexPosition[     15817,        350]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Remove", "[", 
    RowBox[{"\"\<m*\>\"", ",", "\"\<simulation\>\""}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"simulation", "[", "\[Alpha]_", "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "fBest", ",", " ", "p", ",", " ", "rate", ",", " ", "nState", ",", " ", 
      "\[Lambda]", ",", "credit"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"fBest", "=", 
      RowBox[{"10", "**", "9"}]}], " ", ";", " ", 
     RowBox[{"(*", 
      RowBox[{"guess", " ", "per", " ", "second"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"p", "=", 
      RowBox[{"1.0", "/", 
       RowBox[{"(", 
        RowBox[{"fBest", "*", "3600"}], ")"}]}]}], ";", " ", 
     RowBox[{"(*", 
      RowBox[{
      "prob", " ", "of", " ", "win", " ", "for", " ", "each", " ", "guess"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"rate", "=", 
      RowBox[{"fBest", "*", "p"}]}], ";", " ", 
     RowBox[{"(*", 
      RowBox[{"poisson", " ", "rate"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"nState", " ", "=", " ", "10"}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[Lambda]", "=", "1"}], ";", "\[IndentingNewLine]", 
     RowBox[{"credit", " ", "=", "1"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Convert", " ", "idx", " ", "1"}], ",", "2", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"3", ".."}], " ", "to", " ", "state"}], " ", "-", "nState"}],
        ",", " ", 
       RowBox[{
        RowBox[{"-", "nState"}], "+", "1"}], ",", ".."}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"indexToState", "[", "id_", "]"}], "=", 
      RowBox[{
       RowBox[{"-", "nState"}], "+", "id", "-", "1"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"stateToIndex", "[", "st_", "]"}], "=", 
      RowBox[{"st", "+", "nState", "+", "1"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"poissonPDF", "[", "x_", "]"}], "=", 
      RowBox[{"PDF", "[", 
       RowBox[{
        RowBox[{"PoissonDistribution", "[", "\[Lambda]", "]"}], ",", "x"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"minPositiveState", " ", "=", " ", 
      RowBox[{"Max", "[", 
       RowBox[{"0", ",", " ", 
        RowBox[{"InverseCDF", "[", 
         RowBox[{
          RowBox[{"PoissonDistribution", "[", "\[Lambda]", "]"}], ",", 
          RowBox[{"1", "-", "\[Alpha]"}]}], "]"}]}], " ", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "minPositiveState", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", 
        RowBox[{"-", "nState"}]}], ",", 
       RowBox[{"i", "<", "minPositiveState"}], ",", 
       RowBox[{"i", "++"}], ",", 
       RowBox[{
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"j", "=", 
           RowBox[{"-", "nState"}]}], ",", 
          RowBox[{"j", "\[LessEqual]", "nState"}], ",", 
          RowBox[{"j", "++"}], ",", 
          RowBox[{
           RowBox[{
            SubscriptBox["m", 
             RowBox[{"i", ",", "j"}]], "=", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"j", "\[Equal]", 
               RowBox[{"i", "-", "credit"}]}], ",", 
              RowBox[{"poissonPDF", "[", "0", "]"}], ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"j", "<", 
                 RowBox[{"i", "-", "credit"}]}], ",", " ", "0", ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"j", "<", "minPositiveState"}], ",", 
                  RowBox[{"poissonPDF", "[", 
                   RowBox[{"j", "-", "i", "+", "credit"}], "]"}], ",", 
                  RowBox[{"poissonPDF", "[", 
                   RowBox[{"j", "-", "i", "+", "credit"}], "]"}]}], "]"}]}], 
               "]"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "compensate", " ", "for", " ", "the", " ", "overflowing", " ", 
       "state"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox["m", 
       RowBox[{
        RowBox[{"-", "nState"}], ",", 
        RowBox[{"-", "nState"}]}]], "=", 
      RowBox[{
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{"poissonPDF", "[", "i", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "0", ",", 
           RowBox[{"credit", "-", "1"}]}], "}"}]}], "]"}], "+", 
       SubscriptBox["m", 
        RowBox[{
         RowBox[{"-", "nState"}], ",", 
         RowBox[{"-", "nState"}]}]]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "adjust", " ", "transition", " ", "probability", " ", "for", " ", 
       "positive", " ", "states"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "minPositiveState"}], ",", 
       RowBox[{"i", "\[LessEqual]", "nState"}], ",", 
       RowBox[{"i", "++"}], ",", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"j", "=", 
          RowBox[{"-", "1"}]}], ",", 
         RowBox[{"j", "\[LessEqual]", "nState"}], ",", 
         RowBox[{"j", "++"}], ",", 
         RowBox[{
          SubscriptBox["m", 
           RowBox[{"i", ",", "j"}]], "=", 
          RowBox[{"poissonPDF", "[", 
           RowBox[{"j", "+", "1"}], "]"}]}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mat", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        SubscriptBox["m", 
         RowBox[{"i", ",", "j"}]], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"-", "nState"}], ",", "nState"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"-", "nState"}], ",", "nState"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"markovChain", "=", 
      RowBox[{"DiscreteMarkovProcess", "[", 
       RowBox[{
        RowBox[{"nState", "+", "1"}], ",", " ", "mat"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"statP", "[", "x_", "]"}], "=", 
      RowBox[{"N", "[", 
       RowBox[{"PDF", "[", 
        RowBox[{
         RowBox[{"StationaryDistribution", "[", "markovChain", "]"}], ",", 
         "x"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"DiscretePlot", "[", 
       RowBox[{
        RowBox[{"statP", "[", "x", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "1", ",", 
          RowBox[{"nState", "*", "2"}]}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"0", ",", ".2"}], "}"}]}]}], "]"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"pRej", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"statP", "[", "i", "]"}], "*", 
         RowBox[{"(", 
          RowBox[{"i", "-", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"stateToIndex", "[", "minPositiveState", "]"}], "-", 
             "1"}], ")"}]}], ")"}]}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", 
          RowBox[{"stateToIndex", "[", "minPositiveState", "]"}], ",", 
          RowBox[{
           RowBox[{"2", "*", "nState"}], "+", "1"}]}], "}"}]}], "]"}]}], ";", 
     
     RowBox[{"Print", "[", 
      RowBox[{"StringForm", "[", 
       RowBox[{
       "\"\<`1` `2` `3`\>\"", ",", "\[Alpha]", ",", "minPositiveState", ",", 
        " ", "pRej"}], "]"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.694621697017786*^9, 3.694621706635138*^9}, {
   3.694621809048994*^9, 3.69462188783354*^9}, {3.6946219191159067`*^9, 
   3.694621919280311*^9}, {3.694621949506098*^9, 3.694621985208991*^9}, {
   3.6946220155452127`*^9, 3.6946220175831614`*^9}, {3.69462210078369*^9, 
   3.6946221185603323`*^9}, {3.6946221561415787`*^9, 3.694622375778902*^9}, {
   3.694622434052075*^9, 3.694622574888308*^9}, {3.694622648076812*^9, 
   3.694622649187613*^9}, {3.694622839809553*^9, 3.694622839875923*^9}, {
   3.69462312412326*^9, 3.694623131786521*^9}, {3.694623273050767*^9, 
   3.6946233913486853`*^9}, {3.69462366649625*^9, 3.694623691078483*^9}, {
   3.694623724369895*^9, 3.694623745529172*^9}, {3.694623778595964*^9, 
   3.694623830484046*^9}, {3.694623862543495*^9, 3.694623993026185*^9}, {
   3.694624036581236*^9, 3.694624124368175*^9}, {3.6946241600055943`*^9, 
   3.694624182369987*^9}, {3.6946243291221333`*^9, 3.69462434127951*^9}, {
   3.694624430884289*^9, 3.694624432819528*^9}, {3.694624494725031*^9, 
   3.694624529992463*^9}, {3.694624562768712*^9, 3.6946246428295593`*^9}, {
   3.694624698113899*^9, 3.6946248567963676`*^9}, {3.694624904487049*^9, 
   3.694624931883552*^9}, {3.694624980737598*^9, 3.694624984016183*^9}, {
   3.694625019792448*^9, 3.694625034392861*^9}, {3.694625089615534*^9, 
   3.694625128183672*^9}, {3.694625174525337*^9, 3.694625301000594*^9}, {
   3.694625331642713*^9, 3.6946253364323072`*^9}, {3.6946253812157803`*^9, 
   3.6946254487345324`*^9}, {3.694625519035371*^9, 3.6946255362941847`*^9}, {
   3.6946255863081417`*^9, 3.694625610929122*^9}, {3.694625643106675*^9, 
   3.694625683377057*^9}, {3.69462609260359*^9, 3.694626141400539*^9}, {
   3.694626328442032*^9, 3.69462652886728*^9}, {3.694626565213543*^9, 
   3.694626725504046*^9}, {3.694627082596225*^9, 3.694627106970183*^9}, 
   3.694627145395987*^9, 3.694627198681705*^9, {3.694627383147066*^9, 
   3.694627390312593*^9}, {3.6946275170480556`*^9, 3.694627520978457*^9}, {
   3.694627560307569*^9, 3.694627579915987*^9}, {3.694627667057678*^9, 
   3.694627689620357*^9}, {3.694627733116151*^9, 3.694627746025964*^9}, {
   3.6946277998676243`*^9, 3.6946278665853367`*^9}, {3.694627935581801*^9, 
   3.6946279365880537`*^9}, {3.6946279742973747`*^9, 3.694628077097485*^9}, {
   3.694628158896381*^9, 3.694628159397785*^9}, {3.694628301492689*^9, 
   3.6946283333280497`*^9}, 3.694628419793736*^9, {3.694628461346346*^9, 
   3.694628468817319*^9}, 3.694628538043612*^9, {3.694628591155738*^9, 
   3.694628625875173*^9}, {3.694628660553804*^9, 3.694628702265429*^9}, {
   3.694628745880137*^9, 3.694628779041293*^9}, {3.6946292428589087`*^9, 
   3.694629256418556*^9}, {3.694629620443782*^9, 3.6946296392265797`*^9}, {
   3.694630017966445*^9, 3.694630022796021*^9}, 3.694630609638582*^9, 
   3.6946307409981318`*^9, {3.69463090790582*^9, 3.69463092058062*^9}, {
   3.694630960891885*^9, 3.694631075021306*^9}, {3.6946311333720293`*^9, 
   3.694631284273897*^9}, 3.694631328865734*^9, {3.694631849309729*^9, 
   3.694631947710637*^9}, {3.69463198011065*^9, 3.694631993273629*^9}, {
   3.694632025040556*^9, 3.6946320460973167`*^9}, {3.6946320966240883`*^9, 
   3.6946321002632217`*^9}, 3.694632135026629*^9, {3.694632199593316*^9, 
   3.694632251471752*^9}, {3.694632308846819*^9, 3.694632353361804*^9}, {
   3.694632403172304*^9, 3.694632406388389*^9}, {3.69463245652739*^9, 
   3.69463245785911*^9}, 3.6946325537227077`*^9, {3.694632654263517*^9, 
   3.694632675886709*^9}, {3.6946327683351183`*^9, 3.694632775278016*^9}, {
   3.69463280957027*^9, 3.6946328703453817`*^9}, {3.694632914848517*^9, 
   3.6946330262894173`*^9}, {3.694633082614819*^9, 3.694633159332261*^9}, {
   3.6946333761995573`*^9, 3.694633391750925*^9}, {3.69470636334818*^9, 
   3.694706450918507*^9}, {3.6947066104296923`*^9, 3.694706664744232*^9}, {
   3.694706728230853*^9, 3.694706777444008*^9}, {3.6947068317620907`*^9, 
   3.6947068427353277`*^9}, {3.694706981416843*^9, 3.694707059221341*^9}, {
   3.694707102811253*^9, 3.6947071312244387`*^9}, {3.694707183762972*^9, 
   3.6947072547918243`*^9}, {3.694707322752211*^9, 3.6947073233002853`*^9}, {
   3.694707356169647*^9, 3.694707415590529*^9}, {3.694707483800757*^9, 
   3.694707488713758*^9}, {3.694707533495685*^9, 3.694707565929222*^9}, {
   3.694707605209888*^9, 3.694707616087778*^9}, {3.69470765734336*^9, 
   3.694707660184463*^9}, {3.6947076927566223`*^9, 3.6947076979809637`*^9}, {
   3.69470774744582*^9, 3.6947077506364117`*^9}, 3.6947078361264467`*^9, {
   3.694707885766034*^9, 3.694707886900591*^9}, 3.6947080500376596`*^9, {
   3.694779109256051*^9, 3.694779109639728*^9}, {3.694779149793652*^9, 
   3.694779270175138*^9}, {3.694779384231326*^9, 3.694779399275419*^9}, {
   3.694779441802299*^9, 3.694779545742049*^9}, {3.694779937031158*^9, 
   3.694779939028489*^9}, {3.694779974908535*^9, 3.6947800011938066`*^9}, {
   3.694780032337194*^9, 3.694780039935947*^9}, {3.694780709971244*^9, 
   3.69478073528304*^9}, {3.694792900033214*^9, 3.694792978099716*^9}, {
   3.694793016131818*^9, 3.694793019818427*^9}, {3.694793201204083*^9, 
   3.694793288376203*^9}, {3.694793346750779*^9, 3.694793412995895*^9}, {
   3.69479345259508*^9, 3.694793452985154*^9}, 3.69479348568156*^9, {
   3.694793575469996*^9, 3.6947936188499413`*^9}, {3.69479387841647*^9, 
   3.694793889751686*^9}, {3.694794020178741*^9, 3.694794065454907*^9}, {
   3.694794101351555*^9, 3.694794130500518*^9}, {3.6947941678495417`*^9, 
   3.694794172112988*^9}, {3.6947942278013477`*^9, 3.6947942305609093`*^9}, {
   3.694794275375575*^9, 3.6947943099339447`*^9}, {3.6947943615972147`*^9, 
   3.694794363603463*^9}, 3.694794432881002*^9, {3.694795267313092*^9, 
   3.694795267424374*^9}, {3.696118489149564*^9, 3.6961185595697517`*^9}, {
   3.69611866268291*^9, 3.696118675930681*^9}, {3.696118861887216*^9, 
   3.6961188724173098`*^9}, {3.696118910019868*^9, 3.696118915170762*^9}, {
   3.696119155311716*^9, 3.696119155783516*^9}, {3.696119227140326*^9, 
   3.69611929442939*^9}, {3.696119335978382*^9, 3.696119342728817*^9}, {
   3.696119481553406*^9, 3.6961195161773376`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"simulation", "[", "0.05", "]"}]], "Input",
 CellChangeTimes->{{3.694794109544404*^9, 3.694794121858603*^9}, {
   3.694794255597628*^9, 3.694794296939069*^9}, {3.694794380105036*^9, 
   3.694794419885564*^9}, {3.6947948810254908`*^9, 3.694794881107334*^9}, {
   3.69611912107775*^9, 3.6961191350592747`*^9}, 3.696119212881275*^9, 
   3.696119356938868*^9}],

Cell[BoxData["3"], "Print",
 CellChangeTimes->{3.6961193152405643`*^9, 3.696119360968341*^9, 
  3.6961195068437757`*^9}],

Cell[BoxData[
 TemplateBox[{
  "DiscreteMarkovProcess","dmnorm",
   "\"The transition matrix had some row sums that were not 1, so those rows \
have been adjusted by dividing by the row sum or by setting the diagonal \
element to 1.\"",2,9,5,29450154543613391702,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.696119315772541*^9, 3.696119360973854*^9, 
  3.696119506882349*^9}]
}, Open  ]]
},
WindowSize->{1285, 760},
WindowMargins->{{163, Automatic}, {Automatic, 85}},
FrontEndVersion->"11.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 13993, 290, 851, "Input"],
Cell[CellGroupData[{
Cell[14576, 314, 379, 6, 32, "Input"],
Cell[14958, 322, 120, 2, 24, "Print"],
Cell[15081, 326, 402, 8, 24, "Message"]
}, Open  ]]
}
]
*)

